---
title: "Webhooks"
description: "Handle real-time notifications for PIX payments, refunds, and transaction updates"
---

# Webhooks API

Webhooks allow you to receive real-time notifications about PIX payments, refunds, and other transaction events. This section covers webhook configuration and event handling.

## Webhook Events

braix sends webhooks for the following events:

<AccordionGroup>
<Accordion title="Payment Events">
  - **RECEIVE** - PIX deposit confirmed and liquidated
  - **TRANSFER** - PIX withdrawal confirmed and liquidated
  - **CASHOUT** - PIX withdrawal rejected or cancelled
</Accordion>

<Accordion title="Refund Events">
  - **REFUND** - Transaction refunded (deposit or withdrawal)
</Accordion>

<Accordion title="Infraction Events">
  - **INFRACTION** - PIX infraction reported or closed
</Accordion>
</AccordionGroup>

## Webhook Payload Structure

All webhooks follow a consistent payload structure with a `type` field indicating the event type and a `data` object containing the event-specific information.

## RECEIVE - PIX Deposit Confirmed

Sent when a PIX deposit is confirmed and liquidated.

<ResponseExample>
```json RECEIVE
{
  "type": "RECEIVE",
  "data": {
    "id": "txtId_ou_id_da_transacao",
    "status": "LIQUIDATED",
    "payment": {
      "amount": "100.00",
      "currency": "BRL"
    },
    "createdAt": "2025-01-19T10:30:00.000Z",
    "webhookType": "RECEIVE",
    "location": "pix",
    "endToEndId": "E12345678202501191030ABC123",
    "txId": "txtId_da_transacao",
    "externalId": "external_id_do_cliente",
    "debtorAccount": {
      "name": "Nome do Pagador",
      "document": "12345678900",
      "accountType": "CACC"
    },
    "checksum": "hash_checksum"
  }
}
```
</ResponseExample>

## TRANSFER - PIX Withdrawal Confirmed

Sent when a PIX withdrawal is liquidated successfully.

<ResponseExample>
```json TRANSFER
{
  "type": "TRANSFER",
  "data": {
    "id": "id_pixout",
    "txId": "txtId_da_transferencia",
    "pixKey": "chave_pix_destino",
    "status": "LIQUIDATED",
    "payment": {
      "amount": "50.00",
      "currency": "BRL"
    },
    "endToEndId": "E12345678202501191045XYZ789",
    "createdAt": "2025-01-19T10:45:00.000Z",
    "webhookType": "TRANSFER",
    "location": "pix",
    "externalId": "external_id_saque",
    "creditorAccount": {
      "name": "Nome do Destinatário",
      "document": "98765432100",
      "accountType": "CACC"
    },
    "checksum": "hash_checksum"
  }
}
```
</ResponseExample>

## CASHOUT - PIX Withdrawal Rejected/Cancelled

Sent when a PIX withdrawal is rejected or cancelled by the bank.

<ResponseExample>
```json CASHOUT
{
  "type": "CASHOUT",
  "data": {
    "status": "REJECTED",
    "message": "pagamento estornado do banco pagador.",
    "createdAt": "2025-01-19T11:00:00.000Z",
    "endToEndId": "E12345678202501191100ABC456",
    "webhookType": "CASHOUT",
    "idempotencyKey": "idempotency_key_ou_external_id"
  },
  "transaction": {
    "status": "REJECTED",
    "message": "pagamento estornado.",
    "reference": "idempotency_key_ou_external_id"
  }
}
```
</ResponseExample>

## REFUND - Transaction Refunded

Sent when a PIX transaction (deposit or withdrawal) is refunded.

<ResponseExample>
```json REFUND
{
  "type": "REFUND",
  "data": {
    "id": "txtId_original",
    "status": "REFUNDED",
    "payment": {
      "amount": "100.00",
      "currency": "BRL"
    },
    "createdAt": "2025-01-19T11:15:00.000Z",
    "webhookType": "REFUND",
    "location": "pix",
    "endToEndId": "E12345678202501191115DEF789",
    "txId": "txtId_original",
    "externalId": "external_id_original",
    "refundId": "id_do_estorno",
    "originalAmount": "100.00",
    "refundAmount": "100.00",
    "checksum": "hash_checksum"
  }
}
```
</ResponseExample>

### Refund Types

- **PixIn Refund**: Deposit refund (debits user balance)
- **PixOut Refund**: Withdrawal refund (credits user balance)

## INFRACTION - PIX Infraction Reported

Sent when a PIX infraction is reported (status ACKNOWLEDGED).

<ResponseExample>
```json INFRACTION_REPORTED
{
  "type": "INFRACTION",
  "data": {
    "id": "infraction_id",
    "type": "REFUND_REQUEST",
    "status": "ACKNOWLEDGED",
    "endToEndId": "E12345678202501191130GHI012",
    "reportedBy": "DEBTOR",
    "creationDate": "2025-01-19T11:30:00.000Z",
    "reportDetails": "Fraude reportada pelo pagador",
    "analysisResult": null,
    "analysisDetails": null,
    "transactionAmount": {
      "amount": "200.00",
      "currency": "BRL"
    },
    "lastModificationDate": "2025-01-19T11:30:00.000Z"
  }
}
```
</ResponseExample>

## INFRACTION - PIX Infraction Closed

Sent when a PIX infraction is finalized with a result (AGREED or DISAGREED).

<ResponseExample>
```json INFRACTION_CLOSED
{
  "type": "INFRACTION",
  "data": {
    "id": "infraction_id",
    "type": "REFUND_REQUEST",
    "status": "CLOSED",
    "endToEndId": "E12345678202501191145JKL345",
    "reportedBy": "DEBTOR",
    "creationDate": "2025-01-19T11:30:00.000Z",
    "reportDetails": "Fraude confirmada",
    "transactionId": "transaction_id",
    "analysisResult": "AGREED",
    "analysisDetails": "Contestação procedente",
    "transactionAmount": {
      "amount": "200.00",
      "currency": "BRL"
    },
    "lastModificationDate": "2025-01-19T11:45:00.000Z"
  }
}
```
</ResponseExample>

### Analysis Result Values

- **AGREED**: Contest accepted (amount will be refunded)
- **DISAGREED**: Contest rejected (amount maintained)

## Webhook Security

### Checksum Verification

All webhooks include a `checksum` field for verification. Verify the checksum to ensure the webhook is authentic:

<CodeGroup>
```javascript Node.js
const crypto = require('crypto');

const verifyChecksum = (data, receivedChecksum, secret) => {
  // O checksum é calculado com base nos dados da transação original
  // Deve ser o mesmo checksum retornado na requisição de geração do QR Code ou Payment
  const expectedChecksum = crypto
    .createHash('sha256')
    .update(JSON.stringify(data))
    .digest('hex');
  
  return crypto.timingSafeEqual(
    Buffer.from(receivedChecksum),
    Buffer.from(expectedChecksum)
  );
};

// In your webhook handler
app.post('/webhooks/braix', (req, res) => {
  const { data } = req.body;
  const receivedChecksum = data.checksum;
  
  if (!verifyChecksum(data, receivedChecksum, process.env.WEBHOOK_SECRET)) {
    return res.status(401).json({ error: 'Invalid checksum' });
  }
  
  // Process webhook
  res.status(200).json({ received: true });
});
```

```python Python
import hashlib
import hmac

def verify_checksum(data, received_checksum, secret):
    # O checksum é calculado com base nos dados da transação original
    expected_checksum = hashlib.sha256(
        json.dumps(data, sort_keys=True).encode()
    ).hexdigest()
    
    return hmac.compare_digest(received_checksum, expected_checksum)

# In your webhook handler
@app.route('/webhooks/braix', methods=['POST'])
def handle_webhook():
    data = request.get_json()
    received_checksum = data.get('data', {}).get('checksum')
    
    if not verify_checksum(data.get('data', {}), received_checksum, os.getenv('WEBHOOK_SECRET')):
        return jsonify({'error': 'Invalid checksum'}), 401
    
    # Process webhook
    return jsonify({'received': True})
```

```php PHP
<?php
function verifyChecksum($data, $receivedChecksum, $secret) {
    $expectedChecksum = hash('sha256', json_encode($data));
    return hash_equals($receivedChecksum, $expectedChecksum);
}

// In your webhook handler
$data = json_decode(file_get_contents('php://input'), true);
$receivedChecksum = $data['data']['checksum'] ?? '';

if (!verifyChecksum($data['data'], $receivedChecksum, $_ENV['WEBHOOK_SECRET'])) {
    http_response_code(401);
    echo json_encode(['error' => 'Invalid checksum']);
    exit;
}

// Process webhook
echo json_encode(['received' => true]);
?>
```
</CodeGroup>

## Webhook Configuration

### Setting Up Webhooks

1. **Configure Webhook URL**: Set your webhook URL in the braix Dashboard
2. **Verify Endpoint**: Ensure your endpoint returns 200 status for successful webhooks
3. **Handle Retries**: Implement idempotency to handle duplicate webhooks
4. **Monitor Delivery**: Check webhook delivery status in the dashboard

### Webhook Headers

braix sends the following headers with webhooks:

<ParamField header="Content-Type" type="string">
  Always `application/json`
</ParamField>

<ParamField header="X-braix-Event" type="string">
  The event type (e.g., `RECEIVE`, `TRANSFER`, `CASHOUT`, `REFUND`, `INFRACTION`)
</ParamField>

<ParamField header="X-braix-Delivery" type="string">
  Unique delivery ID for tracking
</ParamField>

## Webhook Retry Policy

braix implements the following retry policy for webhooks:

- **Initial attempt**: Immediate
- **Retry 1**: 1 minute after failure
- **Retry 2**: 5 minutes after failure
- **Retry 3**: 15 minutes after failure
- **Retry 4**: 1 hour after failure
- **Retry 5**: 6 hours after failure

<Warning>
Webhooks that fail after all retries are marked as failed and won't be retried again. Check your webhook delivery status regularly.
</Warning>

## Webhook Testing

### Using ngrok for Local Testing

<Steps>
<Step title="Install ngrok">
  Download and install ngrok from [ngrok.com](https://ngrok.com)
</Step>

<Step title="Start Your Server">
  Start your local webhook server on port 3000
</Step>

<Step title="Expose with ngrok">
  Run `ngrok http 3000` to get a public URL
</Step>

<Step title="Configure Webhook URL">
  Use the ngrok URL as your webhook URL in braix Dashboard
</Step>
</Steps>

### Webhook Testing Tools

<CardGroup cols={2}>
<Card title="Webhook.site" icon="globe" href="https://webhook.site">
  Test webhook endpoints with a temporary URL
</Card>

<Card title="RequestBin" icon="code" href="https://requestbin.com">
  Create temporary endpoints to inspect webhook payloads
</Card>
</CardGroup>

## Error Handling

### Common Webhook Errors

<AccordionGroup>
<Accordion title="Timeout Errors">
  - Ensure your webhook endpoint responds within 30 seconds
  - Implement async processing for long-running operations
  - Use proper HTTP status codes (200 for success)
</Accordion>

<Accordion title="Checksum Verification Failures">
  - Verify you're using the correct webhook secret
  - Ensure payload is not modified before verification
  - Check that checksum field is properly extracted
  - Compare with checksum from original transaction
</Accordion>

<Accordion title="Duplicate Webhooks">
  - Implement idempotency using the transaction ID
  - Store processed webhook IDs to prevent duplicates
  - Use database transactions for atomic operations
</Accordion>
</AccordionGroup>

### Webhook Response Requirements

Your webhook endpoint must:

- Return HTTP 200 status for successful processing
- Respond within 30 seconds
- Handle duplicate deliveries gracefully
- Log all webhook events for debugging

<Check>
Webhook endpoints that consistently return non-200 status codes will be disabled automatically.
</Check>
