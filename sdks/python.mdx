---
title: "Python SDK"
description: "Official PinePay Python SDK for server-side applications"
---

# Python SDK

The PinePay Python SDK provides a simple and powerful way to integrate PIX payments into your Python applications.

## Installation

<CodeGroup>
```bash pip
pip install pinepay-sdk
```

```bash pip
pip install pinepay-sdk==1.0.0
```

```bash poetry
poetry add pinepay-sdk
```

```bash conda
conda install -c pinepay pinepay-sdk
```
</CodeGroup>

## Quick Start

```python
from pinepay import PinePayClient

# Initialize the client
client = PinePayClient(
    api_key=os.getenv('PINEPAY_API_KEY'),
    environment='production'  # or 'sandbox'
)

# Create a PIX payment
payment = client.pix.create_payment({
    'amount': 10.50,
    'pixKey': 'user@example.com',
    'webhookUrl': 'https://your-domain.com/webhooks/pinepay',
    'externalId': 'order_123',
    'gateway': 'woovi',
    'description': 'Payment for order #123'
})

print('Payment created:', payment)
```

## Configuration

### Environment Variables

```bash .env
PINEPAY_API_KEY=your_api_key_here
PINEPAY_ENVIRONMENT=production
PINEPAY_BASE_URL=https://api.pinepay.com
```

### Client Options

```python
from pinepay import PinePayClient

client = PinePayClient(
    api_key='your_api_key_here',
    environment='production',  # 'production' or 'sandbox'
    base_url='https://api.pinepay.com',  # Optional, defaults to production URL
    timeout=30,  # Request timeout in seconds
    retries=3,  # Number of retries for failed requests
    retry_delay=1  # Delay between retries in seconds
)
```

## PIX Payments

### Create Payment

```python
payment = client.pix.create_payment({
    'amount': 10.50,
    'pixKey': 'user@example.com',
    'webhookUrl': 'https://your-domain.com/webhooks/pinepay',
    'externalId': 'order_123',
    'gateway': 'woovi',
    'description': 'Payment for order #123'
})

print('Transaction ID:', payment['data']['transactionId'])
print('Status:', payment['data']['status'])
```

### Generate QR Code

```python
qr_code = client.pix.generate_qr_code({
    'amount': 25.00,
    'webhookUrl': 'https://your-domain.com/webhooks/pinepay',
    'externalId': 'qr_123',
    'description': 'QR Code payment'
})

print('QR Code:', qr_code['data']['qrCode'])
print('QR Code Image:', qr_code['data']['qrCodeImage'])
```

### Check Transaction Status

```python
status = client.pix.check_status({
    'txId': 'tx_123456789'
})

print('Transaction status:', status['data']['status'])
```

### Process Refund

```python
refund = client.pix.process_refund({
    'endToEndId': 'E12345678202401151234567890',
    'amount': 10.50
})

print('Refund ID:', refund['data']['refundId'])
```

## Webhooks

### Webhook Handler with Flask

```python
from flask import Flask, request, jsonify
import os

app = Flask(__name__)

@app.route('/webhooks/pinepay', methods=['POST'])
def handle_webhook():
    data = request.get_json()
    webhook_type = data.get('type')
    
    if webhook_type == 'PAYMENT_RECEIVED':
        print('Payment received:', data.get('data'))
        # Handle payment received
    elif webhook_type == 'PAYMENT_FAILED':
        print('Payment failed:', data.get('data'))
        # Handle payment failure
    elif webhook_type == 'QR_CODE_PAID':
        print('QR Code paid:', data.get('data'))
        # Handle QR code payment
    else:
        print('Unknown webhook type:', webhook_type)
    
    return jsonify({'received': True})

if __name__ == '__main__':
    app.run(port=3000)
```

### Webhook Handler with FastAPI

```python
from fastapi import FastAPI, Request
import uvicorn

app = FastAPI()

@app.post('/webhooks/pinepay')
async def handle_webhook(request: Request):
    data = await request.json()
    webhook_type = data.get('type')
    
    if webhook_type == 'PAYMENT_RECEIVED':
        print('Payment received:', data.get('data'))
        # Handle payment received
    elif webhook_type == 'PAYMENT_FAILED':
        print('Payment failed:', data.get('data'))
        # Handle payment failure
    elif webhook_type == 'QR_CODE_PAID':
        print('QR Code paid:', data.get('data'))
        # Handle QR code payment
    else:
        print('Unknown webhook type:', webhook_type)
    
    return {'received': True}

if __name__ == '__main__':
    uvicorn.run(app, port=3000)
```

### Webhook Signature Verification

```python
import hmac
import hashlib

def verify_webhook_signature(payload, signature, secret):
    expected_signature = hmac.new(
        secret.encode('utf-8'),
        payload.encode('utf-8'),
        hashlib.sha256
    ).hexdigest()
    
    return hmac.compare_digest(signature.replace('sha256=', ''), expected_signature)

@app.route('/webhooks/pinepay', methods=['POST'])
def handle_webhook():
    signature = request.headers.get('X-PinePay-Signature')
    payload = request.get_data(as_text=True)
    
    if not verify_webhook_signature(payload, signature, os.getenv('WEBHOOK_SECRET')):
        return jsonify({'error': 'Invalid signature'}), 401
    
    # Process webhook safely
    return jsonify({'received': True})
```

## Error Handling

### Custom Exception Classes

```python
from pinepay.exceptions import (
    PinePayException,
    ValidationException,
    AuthenticationException,
    RateLimitException
)

try:
    payment = client.pix.create_payment(payment_data)
except ValidationException as e:
    print('Validation error:', e.message)
    print('Errors:', e.errors)
except AuthenticationException as e:
    print('Authentication failed:', e.message)
except RateLimitException as e:
    print('Rate limit exceeded, retry after:', e.retry_after)
except PinePayException as e:
    print('PinePay error:', e.message)
except Exception as e:
    print('Unexpected error:', e.message)
```

### Retry Logic

```python
client = PinePayClient(
    api_key=os.getenv('PINEPAY_API_KEY'),
    retries=3,
    retry_delay=1
)

# The SDK will automatically retry failed requests
payment = client.pix.create_payment(payment_data)
```

## Advanced Usage

### Custom Headers

```python
client = PinePayClient(
    api_key=os.getenv('PINEPAY_API_KEY'),
    headers={
        'User-Agent': 'MyApp/1.0.0',
        'X-Custom-Header': 'custom-value'
    }
)
```

### Request Interceptors

```python
def on_request(config):
    print('Making request:', config['url'])
    return config

def on_response(response):
    print('Response received:', response.status_code)
    return response

def on_error(error):
    print('Request failed:', error.message)
    return error

client = PinePayClient(
    api_key=os.getenv('PINEPAY_API_KEY'),
    on_request=on_request,
    on_response=on_response,
    on_error=on_error
)
```

### Batch Operations

```python
import asyncio

async def create_multiple_payments():
    payment_data = [
        {'amount': 10.00, 'pixKey': 'user1@example.com'},
        {'amount': 20.00, 'pixKey': 'user2@example.com'},
        {'amount': 30.00, 'pixKey': 'user3@example.com'}
    ]
    
    tasks = [client.pix.create_payment(data) for data in payment_data]
    payments = await asyncio.gather(*tasks)
    
    print('Created payments:', payments)

# Run async function
asyncio.run(create_multiple_payments())
```

## Django Integration

### Settings

```python
# settings.py
PINEPAY_API_KEY = os.getenv('PINEPAY_API_KEY')
PINEPAY_ENVIRONMENT = os.getenv('PINEPAY_ENVIRONMENT', 'production')
PINEPAY_WEBHOOK_SECRET = os.getenv('PINEPAY_WEBHOOK_SECRET')
```

### View

```python
# views.py
from django.http import JsonResponse
from django.views.decorators.csrf import csrf_exempt
from django.views.decorators.http import require_http_methods
from pinepay import PinePayClient
import json

@csrf_exempt
@require_http_methods(["POST"])
def create_payment(request):
    try:
        data = json.loads(request.body)
        
        client = PinePayClient(
            api_key=settings.PINEPAY_API_KEY,
            environment=settings.PINEPAY_ENVIRONMENT
        )
        
        payment = client.pix.create_payment({
            'amount': data['amount'],
            'pixKey': data['pixKey'],
            'webhookUrl': request.build_absolute_uri('/webhooks/pinepay/'),
            'externalId': data['externalId'],
            'gateway': data['gateway'],
            'description': data['description']
        })
        
        return JsonResponse(payment)
    except Exception as e:
        return JsonResponse({'error': str(e)}, status=500)
```

### URL Configuration

```python
# urls.py
from django.urls import path
from . import views

urlpatterns = [
    path('payments/', views.create_payment, name='create_payment'),
    path('webhooks/pinepay/', views.handle_webhook, name='handle_webhook'),
]
```

## Flask Integration

### Blueprint

```python
# blueprints/payments.py
from flask import Blueprint, request, jsonify
from pinepay import PinePayClient
import os

payments_bp = Blueprint('payments', __name__)

@payments_bp.route('/create', methods=['POST'])
def create_payment():
    try:
        data = request.get_json()
        
        client = PinePayClient(
            api_key=os.getenv('PINEPAY_API_KEY'),
            environment=os.getenv('PINEPAY_ENVIRONMENT', 'production')
        )
        
        payment = client.pix.create_payment({
            'amount': data['amount'],
            'pixKey': data['pixKey'],
            'webhookUrl': request.url_root + 'webhooks/pinepay',
            'externalId': data['externalId'],
            'gateway': data['gateway'],
            'description': data['description']
        })
        
        return jsonify(payment)
    except Exception as e:
        return jsonify({'error': str(e)}), 500

@payments_bp.route('/webhooks/pinepay', methods=['POST'])
def handle_webhook():
    data = request.get_json()
    webhook_type = data.get('type')
    
    if webhook_type == 'PAYMENT_RECEIVED':
        print('Payment received:', data.get('data'))
        # Handle payment received
    
    return jsonify({'received': True})
```

### App Configuration

```python
# app.py
from flask import Flask
from blueprints.payments import payments_bp

app = Flask(__name__)
app.register_blueprint(payments_bp, url_prefix='/api')
```

## Examples

### E-commerce Integration

```python
# ecommerce.py
from flask import Flask, request, jsonify
from pinepay import PinePayClient
import os

app = Flask(__name__)
client = PinePayClient(
    api_key=os.getenv('PINEPAY_API_KEY'),
    environment=os.getenv('PINEPAY_ENVIRONMENT', 'production')
)

@app.route('/checkout', methods=['POST'])
def checkout():
    try:
        data = request.get_json()
        amount = data['amount']
        customer_email = data['customer_email']
        
        payment = client.pix.create_payment({
            'amount': amount,
            'pixKey': customer_email,
            'webhookUrl': 'https://your-domain.com/webhooks/pinepay',
            'externalId': f'order_{int(time.time())}',
            'gateway': 'woovi',
            'description': f'Payment for order {int(time.time())}'
        })
        
        return jsonify({
            'success': True,
            'payment': payment['data']
        })
    except Exception as e:
        return jsonify({
            'success': False,
            'error': str(e)
        }), 500
```

### Subscription Billing

```python
# subscription.py
def create_subscription_payment(subscription_id, amount):
    try:
        payment = client.pix.create_payment({
            'amount': amount,
            'pixKey': 'subscription@example.com',
            'webhookUrl': 'https://your-domain.com/webhooks/pinepay',
            'externalId': f'subscription_{subscription_id}',
            'gateway': 'woovi',
            'description': 'Monthly subscription payment'
        })
        
        return payment
    except Exception as e:
        print(f'Subscription payment failed: {e}')
        raise e
```

### Async Processing

```python
# async_processing.py
import asyncio
from pinepay import PinePayClient

async def process_payments_async(payment_data_list):
    client = PinePayClient(
        api_key=os.getenv('PINEPAY_API_KEY'),
        environment=os.getenv('PINEPAY_ENVIRONMENT', 'production')
    )
    
    tasks = []
    for data in payment_data_list:
        task = asyncio.create_task(
            client.pix.create_payment(data)
        )
        tasks.append(task)
    
    results = await asyncio.gather(*tasks, return_exceptions=True)
    
    for i, result in enumerate(results):
        if isinstance(result, Exception):
            print(f'Payment {i} failed: {result}')
        else:
            print(f'Payment {i} created: {result["data"]["transactionId"]}')

# Usage
payment_data_list = [
    {'amount': 10.00, 'pixKey': 'user1@example.com'},
    {'amount': 20.00, 'pixKey': 'user2@example.com'},
    {'amount': 30.00, 'pixKey': 'user3@example.com'}
]

asyncio.run(process_payments_async(payment_data_list))
```

## API Reference

### PinePayClient

<ParamField name="api_key" type="string" required>
Your PinePay API key
</ParamField>

<ParamField name="environment" type="string" default="production">
Environment: 'production' or 'sandbox'
</ParamField>

<ParamField name="base_url" type="string">
Custom base URL for the API
</ParamField>

<ParamField name="timeout" type="integer" default="30">
Request timeout in seconds
</ParamField>

<ParamField name="retries" type="integer" default="3">
Number of retries for failed requests
</ParamField>

<ParamField name="retry_delay" type="integer" default="1">
Delay between retries in seconds
</ParamField>

### Methods

<ResponseField name="pix.create_payment" type="method">
Create a new PIX payment
</ResponseField>

<ResponseField name="pix.generate_qr_code" type="method">
Generate a PIX QR code
</ResponseField>

<ResponseField name="pix.check_status" type="method">
Check transaction status
</ResponseField>

<ResponseField name="pix.process_refund" type="method">
Process a PIX refund
</ResponseField>

<ResponseField name="pix.get_transactions" type="method">
Get user transactions
</ResponseField>

<ResponseField name="pix.get_statistics" type="method">
Get transaction statistics
</ResponseField>
